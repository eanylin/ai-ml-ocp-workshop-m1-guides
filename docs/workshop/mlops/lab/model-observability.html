<!DOCTYPE html>
<html>
<head>
  <title>
      The MLOps Workshop
  </title>
  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="oPTLBcQ+0zd4zvTwmhh1SPVvquZzJkC479rf2Re1gUzIO4oF0ZrdekN23fPQYmY//nTvicYSTM3C6eFokQ8GAw==" />
  <link rel="stylesheet" media="all" href="../../../assets/application-dcf5640dabe7c086c5db76b2e378b4def3309902bc32af61ab63094a23e1730b.css" data-turbolinks-track="reload" />
  <script src="../../../assets/application-1763c4134299cf1911a383dd8d9b23b574b429196c500fbba1a010629fc4c558.js" data-turbolinks-track="reload"></script>
</head>

<script type="text/javascript">
function gowithuser() {
    window.location.search = ('&userid=' + document.getElementById('useridfield').value);
}
function recycle() {
  window.location.search = ('&userid=reset');
}
</script>

<body>
<nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid d-flex justify-content-start">
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>
      <a class="navbar-brand mb-0 h1" href="../../mlops.html" id="workshopName">The MLOps Workshop</a>
        <span class="navbar-text" style="margin-right: 1rem;">|</span>
        <span class="navbar-text">Model Monitoring and Observability</span>
        <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
        <span class="navbar-text">User ID: user1</span>
        <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
  </div>
</nav>

<script type="application/javascript">
    if (App.hasOwnProperty('subscription_id')) {
        App.cable.subscriptions.remove(App.subscription_id);
    }

    App.subscription_id = App.report_page_view('mlops#model-observability', 'd9172ed7-510d-408a-b653-5c241996eae0');
</script>

<main class="container-fluid">
  <div class="row">
    <div class="col-md-3">
      <ul class="list-group" id="labs-menu">
            <a href="../../mlops.html" class="list-group-item list-group-item-action list-group-item-success">
              1. Kubernetes Overview
            </a>
            <a href="navigating-openshift-ui.html" class="list-group-item list-group-item-action list-group-item-success">
              2. Navigating OpenShift Web Console
            </a>
            <a href="getting-started-mlops.html" class="list-group-item list-group-item-action list-group-item-success">
              3. Getting Started with MLOps
            </a>
            <a href="workshop-environment.html" class="list-group-item list-group-item-action list-group-item-success">
              4. Your Workshop Environment
            </a>
            <a href="exploring-data.html" class="list-group-item list-group-item-action list-group-item-success">
              5. Exploring Data
            </a>
            <a href="building-the-first-model.html" class="list-group-item list-group-item-action list-group-item-success">
              6. Build the First Model
            </a>
            <a href="productize-the-model.html" class="list-group-item list-group-item-action list-group-item-success">
              7. Productize the Model
            </a>
            <a href="deploy-to-staging.html" class="list-group-item list-group-item-action list-group-item-success">
              8. Deploy The Model To Staging
            </a>
            <a href="promote-to-production.html" class="list-group-item list-group-item-action list-group-item-success">
              9. Promote to Production
            </a>
            <li class="list-group-item active">
              <span>10. Model Monitoring and Observability</span>
            </li>
            <a href="continuous-training.html" class="list-group-item list-group-item-action">
              11. Continuous Training With A/B Testing
            </a>
            <a href="decide-on-final-model.html" class="list-group-item list-group-item-action">
              12. Deploy The Chosen One
            </a>
            <a href="integrate-with-application-services.html" class="list-group-item list-group-item-action">
              13. Completing the Solution with Red Hat Application Services
            </a>
        <a href="../complete.html" class="list-group-item list-group-item-action list-group-item-warning">
          <i class="fa fa-print"></i> All labs in one page
        </a>
      </ul>
    </div>
    <div class="col-md-9">
      <div class="card" id="lab-content">
        <div class="card-header">
          <h6>
            <span class="pull-left badge badge-pill badge-primary">10</span>
            <span class="pull-left ml-2">Model Monitoring and Observability</span>
          </h6>
        </div>
        <div class="card-body">
          <div class="sect1">
<h2 id="_model_monitoring_and_observability">Model Monitoring and Observability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Monitoring has been configured in this workshop. Prometheus will be scraping the metrics from the model and Grafana will be the interactive visualization web dashboard.</p>
</div>
<div class="paragraph">
<p>Prometheus is an open-source systems monitoring and alerting toolkit originally built at SoundCloud. Since its inception in 2012, many companies and organizations have adopted Prometheus, and the project has a very active developer and user community. It is now a standalone open source project and maintained independently of any company. To emphasize this, and to clarify the project&#8217;s governance structure, Prometheus joined the Cloud Native Computing Foundation in 2016 as the second hosted project, after Kubernetes.</p>
</div>
<div class="paragraph">
<p>Grafana is open source visualization and analytics software. It allows you to query, visualize, alert on, and explore your metrics no matter where they are stored. In plain English, it provides you with tools to turn your time-series database (TSDB) data into beautiful graphs and visualizations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_looking_at_metrics">Looking At Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Grafana dashboard has been <a href="https://grafana-route-labs-grafana.apps.cluster-844c.844c.example.opentlc.com//d/U1cSDzyZz/prediction-analytics" target="_blank" rel="noopener">configured</a>.</p>
</div>
<div class="paragraph">
<p>Go to Home and find the <code>Prediction Analytics</code> dashboard.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../asset/images/grafana-home.png" alt="grafana-home" width="200">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../asset/images/grafana-dashboard.png" alt="grafana-dashboard" width="700">
</div>
</div>
<div class="paragraph">
<p>The dashboard has been configured to look at several metrics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Requests/second</p>
</li>
<li>
<p>Latency</p>
</li>
<li>
<p>True/False and Positive/Negative count</p>
</li>
<li>
<p>Accuracy</p>
</li>
<li>
<p>Precision</p>
</li>
<li>
<p>Recall</p>
</li>
<li>
<p>F1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Choose your image and namespace <code>user1-prod</code> and view the metrics from your model.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../asset/images/grafana-dropdown.png" alt="grafana-dropdown" width="500">
</div>
</div>
<div class="paragraph">
<p>We are interested in the recall score of the model, which is the ratio TP / (TP + FN). Recall is a good metric to use when the cost associated with false negative (FN) is high. In this classification problem there is a high cost for the bank when a fraud transaction is predicted as non-fraud, since no actions can be taken. Thus, recall is one important metric to pay attention to.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../asset/images/grafana-recall.png" alt="grafana-recall" width="400">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exposing_metrics_to_prometheus">Exposing Metrics to Prometheus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Seldon models expose a prometheus <code>/prometheus</code> endpoint and we have configured Prometheus <code>ServiceMonitor</code> to scrape these endpoints.</p>
</div>
<div class="paragraph">
<p>A ServiceMonitor describes the set of targets to be monitored by Prometheus, which declaratively specifies how groups of Kubernetes services should be monitored. The Prometheus Operator automatically generates Prometheus scrape configuration based on the current state of the objects in the API server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">apiVersion</span>: <span class="string"><span class="content">monitoring.coreos.com/v1</span></span>
<span class="key">kind</span>: <span class="string"><span class="content">ServiceMonitor</span></span>
<span class="key">metadata</span>:
  <span class="key">name</span>: <span class="string"><span class="content">odh-seldon</span></span>
  <span class="key">namespace</span>: <span class="string"><span class="content">userX-prod</span></span>
<span class="key">spec</span>:
  <span class="key">endpoints</span>:
    - <span class="string"><span class="content">interval: 30s</span></span>
      <span class="key">path</span>: <span class="string"><span class="content">/prometheus</span></span>
      <span class="key">port</span>: <span class="string"><span class="content">http</span></span>
      <span class="key">scheme</span>: <span class="string"><span class="content">http</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Seldon service orchestrator exposes core metrics such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>seldon_api_executor_server_requests_seconds_(bucket,count,sum)</p>
</li>
<li>
<p>seldon_api_executor_client_requests_seconds_(bucket,count,sum)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>, and custom metrics added to the model class via the <a href="https://gogs-labs-infra.apps.cluster-844c.844c.example.opentlc.com/user1/rh-mlops-workshop"><code>Base</code></a> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">Base</span>(<span class="predefined">object</span>):
  <span class="keyword">def</span> <span class="function">metrics</span>(<span class="predefined-constant">self</span>):
    <span class="keyword">pass</span>
  <span class="keyword">def</span> <span class="function">send_feedback</span>(<span class="predefined-constant">self</span>, features, feature_names, reward, truth, routing):
    <span class="keyword">pass</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_feedback_endpoint">Feedback endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Seldon model provides a <code>/api/v1.0/feedback</code> endpoint that allows you to send back feedback to the model, which allows us to calculate various scores.</p>
</div>
<div class="paragraph">
<p>This is extremely useful when multi-armed bandits are used for reinforced learning, so as to maximize a numerical reward signal.</p>
</div>
</div>
</div>
        </div>
        <div class="card-footer">
            <a href="promote-to-production.html" class="btn btn-primary btn-sm pull-left">
              <i class="fa fa-arrow-left"></i> Promote to Production
            </a>
            <a href="continuous-training.html" class="btn btn-primary btn-sm pull-right">
              Continuous Training With A/B Testing <i class="fa fa-arrow-right"></i>
            </a>
        </div>
      </div>
    </div>
  </div>
</main>


</body>
</html>
